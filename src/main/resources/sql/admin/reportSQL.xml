<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.eosa.admin.mapper.ReportMapper">

    <!-- 신고 목록 개수 조회 -->
    <select id="countReportList" resultType="int" parameterType="hashmap">
        SELECT COUNT(*)
        FROM ReportForm R
        <where>
            <if test="state != null">
                AND R.reportCheckState = #{state}
            </if>
        </where>
    </select>

    <!-- 신고 목록 조회 -->
    <select id="selectReportList" resultType="ReportDTO" parameterType="hashmap">
        SELECT R.idx,
               R.companysIdx,
               R.reportDetail,
               R.reportCheckState,
               R.reportDate,
               R.reportCheckDate,
               U.usersAccount,
               C.companysName
        FROM ReportForm R
                 JOIN Users U ON R.usersIdx = U.usersIdx
                 JOIN Companys C ON R.companysIdx = C.companysIdx
        <where>
            <if test="state != null">
                AND R.reportCheckState = #{state}
            </if>
        </where>
        ORDER BY R.reportDate DESC LIMIT #{startIndex}, #{pageSize}
    </select>

    <!-- 신고목록 처리 상태 업데이트 -->
    <update id="reportUpdate">
        UPDATE ReportForm R
        SET R.reportCheckState = #{reportCheckState},
            R.reportCheckDate = NOW()
        WHERE R.idx = #{idx}
    </update>

    <!-- 신고 삭제 -->
    <delete id="deleteReport" parameterType="long">
        DELETE
        FROM ReportForm
        WHERE idx = ${idx}
    </delete>

    <!-- 신고 다중 삭제 -->
    <delete id="deleteReportMulti">
        DELETE
        FROM ReportForm
        WHERE idx IN
        <foreach collection="array" item="arr" index="i" open="(" separator="," close=")">
            #{arr}
        </foreach>
    </delete>

</mapper>
