<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.eosa.admin.mapper.AdminMapper">

    <!-- 관리자 등록 -->
    <insert id="insertAdmin" parameterType="UsersDTO">
        INSERT INTO Users (usersAccount,
                           usersPass,
                           usersName,
                           usersNick,
                           usersPhone,
                           usersEmail,
                           usersRole,
                           usersAge,
                           usersRegion1,
                           usersRegion2,
                           usersGender,
                           usersJoinDate,
                           usersNotice,
                           usersEnabled,
                           usersDelete)
        VALUES (#{usersAccount},
                #{usersPass},
                #{usersName},
                #{usersName},
                #{usersPhone},
                #{usersEmail},
                'ADMIN',
                10,
                NULL,
                NULL,
                0,
                NOW(),
                0,
                1,
                0)
    </insert>

    <!-- 관리자 목록 개수 조회 -->
    <select id="countAdmin" resultType="int">
        SELECT COUNT(*)
        FROM Users
        WHERE usersRole = 'ADMIN'
    </select>

    <!-- 관리자 목록 조회 -->
    <select id="selectAdmin" resultType="UsersDTO" parameterType="hashmap">
        SELECT U.usersIdx,
               U.usersAccount,
               U.usersName,
               U.usersPhone,
               U.usersEmail,
               U.usersJoinDate
        FROM Users U
        WHERE U.usersRole = 'ADMIN'
        ORDER BY U.usersJoinDate DESC LIMIT #{startIndex}, #{pageSize}
    </select>

    <!-- 관리자 상세 조회 -->
    <select id="selectAdminDetails" resultType="UsersDTO">
        SELECT U.usersIdx,
               U.usersAccount,
               U.usersName,
               U.usersPhone,
               U.usersEmail,
               U.usersJoinDate
        FROM Users U
        WHERE U.usersIdx = #{usersIdx}
    </select>

    <!-- 비밀번호 변경 -->
    <update id="updatePwd" parameterType="UsersDTO">
        UPDATE Users
        SET usersPass = #{usersPass}
        WHERE usersIdx = #{usersIdx}
    </update>

    <!-- 관리자 수정 -->
    <update id="updateAdmin" parameterType="UsersDTO">
        UPDATE Users
        SET usersName = #{usersName},
            usersPhone = #{usersPhone},
            usersEmail = #{usersEmail}
        WHERE usersIdx = #{usersIdx}
    </update>

    <!-- 아이디 중복검사 -->
    <select id="countAccount" resultType="int">
        SELECT COUNT(*)
        FROM Users
        WHERE usersAccount = #{usersAccount}
    </select>

    <!-- 연락처 중복검사 -->
    <select id="countPhone" resultType="int">
        SELECT COUNT(*)
        FROM Users
        WHERE usersPhone = #{usersPhone}
    </select>

</mapper>
