<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.eosa.admin.mapper.UserMapper">

    <!-- 회원 목록 개수 조회 -->
    <select id="countUsersList" resultType="int" parameterType="hashmap">
        SELECT COUNT(*)
        FROM Users U
        WHERE U.usersDelete = 0
          AND U.usersRole = #{usersRole}
        <if test="id != null">
            AND CONCAT(U.usersAccount) REGEXP #{search}
        </if>
        <if test="name != null">
            AND CONCAT(U.usersName) REGEXP #{search}
        </if>
        <if test="phone != null">
            AND CONCAT(U.usersPhone) REGEXP #{search}
        </if>
    </select>

    <!-- 회원 목록 조회 -->
    <select id="selectUsersList" resultType="UsersDTO" parameterType="hashmap">
        SELECT U.usersIdx,
               U.usersAccount,
               U.usersName,
               U.usersNick,
               U.usersPhone,
               U.usersEmail,
               U.usersAge,
               U.usersRegion1,
               U.usersRegion2,
               U.usersGender,
               U.usersJoinDate
        FROM Users U
        WHERE U.usersDelete = 0
          AND U.usersRole = #{usersRole}
        <if test="id != null">
            AND CONCAT(U.usersAccount) REGEXP #{search}
        </if>
        <if test="name != null">
            AND CONCAT(U.usersName) REGEXP #{search}
        </if>
        <if test="phone != null">
            AND CONCAT(U.usersPhone) REGEXP #{search}
        </if>
        ORDER BY U.usersJoinDate DESC LIMIT #{startIndex}, #{pageSize}
    </select>

    <!-- 회원 상세 조회 -->
    <select id="selectUsersDetails" resultType="UsersDTO">
        SELECT U.usersIdx,
               U.usersAccount,
               U.usersName,
               U.usersNick,
               U.usersPhone,
               U.usersEmail,
               U.usersRole,
               U.usersAge,
               U.usersRegion1,
               U.usersRegion2,
               U.usersGender,
               U.usersJoinDate,
               U.usersNotice
        FROM Users U
        WHERE usersIdx = #{usersIdx}
    </select>

</mapper>
